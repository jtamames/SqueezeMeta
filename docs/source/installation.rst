************************
Installation and testing
************************

SqueezeMeta is intended to be run in a x86-64 Linux OS (tested in Ubuntu
and CentOS). The easiest way to install it is by using conda. The
default conda solver might however be slow solving the dependencies, so
it’s better to first set up the libmamba solver with

::

   conda update -n base conda # if your conda version is below 22.11
   conda install -n base conda-libmamba-solver
   conda config --set solver libmamba

and then use conda to install SqueezeMeta

::

   conda create -n SqueezeMeta -c conda-forge -c bioconda -c fpusan squeezemeta=1.7 --no-channel-priority --override-channels

This will create a new conda environment named SqueezeMeta, which must
then be activated.

::

   conda activate SqueezeMeta

When using conda, all the scripts from the SqueezeMeta distribution will
be available on ``$PATH``.

Alternatively, you can download the latest release from the GitHub
repository and uncompress the tarball in a suitable directory. The
tarball includes the SqueezeMeta scripts as well as the third-party
software redistributed with SqueezeMeta. The ``INSTALL`` files contain
detailed installation instructions, including all the external libraries
required to make SqueezeMeta run in a vanilla Ubuntu 20.04. Note that
you may need different libraries and potentially recompiling some
binaries from source in order for the manual install to work in other
Ubuntu versions or other distributions. The conda method is now the
recommended way to install SqueezeMeta, and we will no longer
support issues regarding manual installation.

The ``test_install.pl`` script can be run in order to check whether the
required dependencies are available in your environment.

::

    /path/to/SqueezeMeta/utils/install_utils/test_install.pl

Downloading or building databases
=================================

SqueezeMeta uses several databases. GenBank nr for taxonomic assignment,
and eggnog, KEGG and Pfam for functional assignment. The script
*download_databases.pl* can be run to download a pre-formatted version
of all the databases required by SqueezeMeta.

::
   
   /path/to/SqueezeMeta/utils/install_utils/download_databases.pl /download/path

, where ``/download/path`` is the destination folder. This is the
recommended option, but the files are hosted in our institutional
server, which can at times be unreachable.

Alternatively, the script ``make_databases.pl`` can be run to download
from source and format the latest version of the databases.

::

   /path/to/SqueezeMeta/utils/install_utils/make_databases.pl /download/path

Generally, ``download_databases.pl`` is the safest choice for getting
your databases set up. When running ``make_databases.pl``, data download
(e.g. from the NCBI server) can be interrupted, leading to a corrupted
database. Always run ``test_install.pl`` to check that the database was
properly created. Otherwise, you can try re-running
``make_databases.pl``, or just run ``download_databases.pl`` instead.

The databases occupy 470Gb, but we recommend having at least 700Gb free
disk space during the building process.

Two directories will be generated after running either
``make_databases.pl`` or ``download_databases.pl``.

- ``/download/path/db``, which contains the actua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l databases.
- ``/download/path/test``, which contains data for a test run of SqueezeMeta.

If the SqueezeMeta databases are already built in another location in
the system, a different copy of SqueezeMeta can be configured to use
them with

::

   /path/to/SqueezeMeta/utils/install_utils/configure_nodb.pl /path/to/db

, where ``/path/to/db`` is the route to the ``db`` folder that was
generated by either ``make_databases.pl`` or ``download_databases.pl``.

After configuring the databases, the ``test_install.pl`` can be run in
order to check that SqueezeMeta is ready to work (see previous section).

Updating SqueezeMeta
====================

Assuming your databases are not inside the SqueezeMeta directory, just
remove it, download the new version and configure it with

::

  /path/to/SqueezeMeta/utils/install_utils/configure_nodb.pl /path/to/db
